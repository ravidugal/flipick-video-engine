<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flipick Video Engine</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=Space+Mono&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --primary:#444ce7;--primary-light:#849bff;--primary-bg:#eef0ff;
  --gray-dark:#545454;--gray-mid:#7b8fa2;--gray-light:#aaabab;--gray-border:#e2e4e9;
  --bg-white:#fff;--bg-light:#f8f9fb;--bg-page:#f0f2f5;--success:#10b981;
  --font-display:'Playfair Display',Georgia,serif;
  --font-body:'Inter',system-ui,sans-serif;
  --font-mono:'Space Mono',monospace;
}
body{font-family:var(--font-body);background:var(--bg-page);color:#000;min-height:100vh}

/* Header */
.header{background:var(--bg-white);border-bottom:1px solid var(--gray-border);padding:0.75rem 1.5rem;display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;align-items:center;gap:0.5rem;font-weight:600;font-size:1rem}
.logo-icon{width:28px;height:28px;background:linear-gradient(135deg,var(--primary),var(--primary-light));border-radius:6px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:0.8rem}
.status-row{display:flex;gap:0.75rem}
.status-pill{display:flex;align-items:center;gap:0.3rem;padding:0.3rem 0.6rem;background:var(--bg-light);border-radius:99px;font-size:0.7rem}
.status-dot{width:6px;height:6px;border-radius:50%;background:var(--gray-light)}
.status-dot.on{background:var(--success)}

/* Layout */
.main{max-width:1600px;margin:0 auto;padding:1.5rem;display:grid;grid-template-columns:360px 1fr;gap:1.5rem}
.sidebar{display:flex;flex-direction:column;gap:1rem;max-height:calc(100vh - 100px);overflow-y:auto}

/* Cards */
.card{background:var(--bg-white);border-radius:10px;border:1px solid var(--gray-border)}
.card-header{padding:0.75rem 1rem;border-bottom:1px solid var(--gray-border);display:flex;justify-content:space-between;align-items:center}
.card-title{font-weight:600;font-size:0.85rem}
.card-step{font-size:0.65rem;font-weight:600;color:var(--primary);background:var(--primary-bg);padding:0.2rem 0.5rem;border-radius:99px}
.card-body{padding:1rem}

/* Forms */
.form-group{margin-bottom:0.75rem}
.form-label{display:block;font-size:0.75rem;font-weight:500;color:var(--gray-dark);margin-bottom:0.4rem}
.form-input{width:100%;padding:0.5rem 0.7rem;background:var(--bg-light);border:1px solid var(--gray-border);border-radius:5px;font-size:0.8rem;font-family:var(--font-body)}
.form-input:focus{outline:none;border-color:var(--primary)}
textarea.form-input{min-height:60px;resize:vertical}

/* Select Grid */
.select-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:0.4rem}
.select-option{padding:0.5rem;background:var(--bg-light);border:2px solid transparent;border-radius:5px;text-align:center;font-size:0.7rem;color:var(--gray-dark);cursor:pointer;transition:all 0.15s}
.select-option:hover{background:var(--primary-bg);color:var(--primary)}
.select-option.selected{background:var(--primary-bg);border-color:var(--primary);color:var(--primary);font-weight:500}

/* Tabs */
.tabs{display:flex;border-bottom:1px solid var(--gray-border);margin:-1rem -1rem 0.75rem}
.tab{padding:0.6rem 0.8rem;font-size:0.75rem;font-weight:500;color:var(--gray-mid);border-bottom:2px solid transparent;cursor:pointer;transition:all 0.15s}
.tab.active{color:var(--primary);border-color:var(--primary)}

/* Topics */
.topics-list{border:1px solid var(--gray-border);border-radius:5px;max-height:180px;overflow-y:auto}
.topic-item{padding:0.5rem 0.75rem;border-bottom:1px solid var(--gray-border);display:flex;align-items:center;gap:0.4rem;font-size:0.8rem}
.topic-item:last-child{border-bottom:none}
.topic-item.sub{padding-left:1.5rem;background:var(--bg-light);font-size:0.75rem}
.topic-name{flex:1}
.topic-del{background:none;border:none;color:var(--gray-light);cursor:pointer;transition:color 0.15s}
.topic-del:hover{color:#ef4444}

.add-btn{width:100%;padding:0.5rem;background:var(--bg-light);border:1px dashed var(--gray-border);border-radius:5px;color:var(--gray-mid);font-size:0.75rem;cursor:pointer;margin-top:0.5rem;transition:all 0.15s}
.add-btn:hover{background:var(--primary-bg);border-color:var(--primary);color:var(--primary)}

/* Voice */
.voice-grid{display:grid;grid-template-columns:1fr 1fr;gap:0.4rem}
.voice-card{padding:0.5rem;background:var(--bg-light);border:2px solid transparent;border-radius:5px;cursor:pointer;font-size:0.75rem;transition:all 0.15s}
.voice-card.selected{background:var(--primary-bg);border-color:var(--primary)}

/* Buttons */
.btn{display:flex;align-items:center;justify-content:center;gap:0.4rem;padding:0.6rem 1rem;font-size:0.8rem;font-weight:500;border-radius:5px;border:none;cursor:pointer;font-family:var(--font-body);transition:all 0.15s}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{background:#3538c9;transform:translateY(-1px)}
.btn-secondary{background:var(--bg-light);color:var(--gray-dark);border:1px solid var(--gray-border)}
.btn-full{width:100%}
.btn-lg{padding:0.75rem 1.25rem;font-size:0.85rem}

/* 16:9 Video Player */
.player-wrapper{position:relative;width:100%;background:#000;border-radius:10px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
.player-aspect{position:relative;width:100%;padding-top:56.25%}
.player-content{position:absolute;top:0;left:0;width:100%;height:100%}
.viewport{width:100%;height:100%;position:relative;overflow:hidden}

/* Empty State */
.empty-state{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;text-align:center}
.empty-icon{font-size:2.5rem;margin-bottom:0.75rem;opacity:0.5}
.empty-title{font-size:1rem;font-weight:600}
.empty-text{font-size:0.8rem;color:rgba(255,255,255,0.6)}

/* Loading */
.loading{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:30}
.loading.active{display:flex}
.spinner{width:36px;height:36px;border:3px solid rgba(255,255,255,0.1);border-top-color:var(--primary-light);border-radius:50%;animation:spin 0.8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{margin-top:0.75rem;font-size:0.8rem;color:rgba(255,255,255,0.7)}

/* Scenes */
.scene{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;visibility:hidden}
.scene.active{opacity:1;visibility:visible}
.scene.fade-in{animation:fadeIn 0.8s ease forwards}
.scene.fade-out{animation:fadeOut 0.5s ease forwards}
@keyframes fadeIn{from{opacity:0}to{opacity:1;visibility:visible}}
@keyframes fadeOut{from{opacity:1}to{opacity:0;visibility:hidden}}

/* Scene Background */
.scene-bg{position:absolute;top:0;left:0;width:100%;height:100%}
.scene-bg video,.scene-bg img{width:100%;height:100%;object-fit:cover}
.scene-bg video{animation:kb 18s ease infinite alternate}
@keyframes kb{0%{transform:scale(1) translate(0,0)}100%{transform:scale(1.12) translate(-1.5%,-1%)}}

/* Cinematic Overlays */
.scene-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(to top,rgba(0,0,0,0.95) 0%,rgba(0,0,0,0.4) 50%,rgba(0,0,0,0.2) 100%)}
.scene-vignette{position:absolute;top:0;left:0;width:100%;height:100%;box-shadow:inset 0 0 150px rgba(0,0,0,0.7);pointer-events:none}
.scene-grain{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0.04;pointer-events:none;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E")}
.scene-color-grade{position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,rgba(68,76,231,0.08) 0%,transparent 50%,rgba(132,155,255,0.05) 100%);pointer-events:none;mix-blend-mode:overlay}

/* Scene Content */
.scene-content{position:absolute;bottom:8%;left:5%;right:5%;color:#fff;z-index:10}
.scene-content.centered{left:50%;right:auto;transform:translateX(-50%);text-align:center;display:flex;flex-direction:column;align-items:center;max-width:800px;width:90%}

/* Typography - Cinematic */
.scene-eyebrow{font-family:var(--font-mono);font-size:0.65rem;font-weight:400;letter-spacing:0.2em;text-transform:uppercase;color:var(--primary-light);margin-bottom:0.5rem;opacity:0;transform:translateY(15px)}
.scene-title{font-family:var(--font-display);font-size:clamp(1.5rem,4vw,2.8rem);font-weight:600;line-height:1.15;margin-bottom:0.5rem;opacity:0;transform:translateY(20px);text-shadow:0 4px 30px rgba(0,0,0,0.5)}
.scene-subtitle{font-family:var(--font-display);font-size:clamp(1rem,2vw,1.4rem);color:var(--primary-light);margin-bottom:0.4rem;opacity:0;transform:translateY(15px);font-weight:400;font-style:italic}
.scene-body{font-family:var(--font-body);font-size:0.9rem;line-height:1.7;color:rgba(255,255,255,0.85);max-width:600px;opacity:0;transform:translateY(15px)}

/* Bullets */
.scene-bullets{list-style:none;margin-top:0.75rem;opacity:0;transform:translateY(15px)}
.scene-bullets li{padding:0.4rem 0 0.4rem 1.5rem;position:relative;font-size:0.85rem;color:rgba(255,255,255,0.9);font-family:var(--font-body)}
.scene-bullets li:before{content:"";position:absolute;left:0;top:0.7rem;width:8px;height:8px;background:var(--primary-light);border-radius:50%;box-shadow:0 0 10px var(--primary-light)}

/* Cards */
.scene-cards{display:grid;gap:0.75rem;margin-top:1rem;opacity:0;transform:translateY(15px)}
.scene-cards.cols-2{grid-template-columns:1fr 1fr;max-width:700px}
.scene-cards.cols-3{grid-template-columns:1fr 1fr 1fr;max-width:900px}
.scene-card{background:rgba(255,255,255,0.08);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.12);border-radius:12px;padding:1rem;transition:all 0.3s}
.scene-card:hover{background:rgba(255,255,255,0.12);transform:translateY(-2px)}
.scene-card-title{font-family:var(--font-body);font-size:0.85rem;font-weight:600;color:#fff;margin-bottom:0.3rem}
.scene-card-desc{font-family:var(--font-body);font-size:0.75rem;color:rgba(255,255,255,0.7);line-height:1.5}

/* Timeline */
.scene-timeline{margin-top:1rem;opacity:0;transform:translateY(15px);max-width:600px}
.timeline-item{display:flex;gap:1rem;padding:0.6rem 0;border-left:2px solid var(--primary-light);padding-left:1.25rem;margin-left:0.5rem;position:relative}
.timeline-item:before{content:"";position:absolute;left:-5px;top:0.8rem;width:8px;height:8px;background:var(--primary-light);border-radius:50%;box-shadow:0 0 10px var(--primary-light)}
.timeline-year{font-family:var(--font-mono);font-size:0.75rem;font-weight:600;color:var(--primary-light);min-width:60px}
.timeline-event{font-family:var(--font-body);font-size:0.8rem;color:rgba(255,255,255,0.85);line-height:1.5}

/* Stat */
.scene-stat{text-align:center;padding:1.5rem 0}
.scene-stat-value{font-family:var(--font-display);font-size:clamp(3rem,10vw,6rem);font-weight:700;background:linear-gradient(135deg,#fff 0%,var(--primary-light) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;opacity:0;transform:scale(0.7);text-shadow:none}
.scene-stat-label{font-family:var(--font-body);font-size:1rem;color:rgba(255,255,255,0.8);margin-top:0.5rem;opacity:0;transform:translateY(15px)}

/* Quote */
.scene-quote-wrapper{max-width:650px;text-align:center}
.scene-quote{font-family:var(--font-display);font-size:clamp(1.2rem,2.5vw,1.6rem);font-style:italic;line-height:1.6;color:rgba(255,255,255,0.95);opacity:0;transform:translateY(15px);position:relative;padding:0 2rem}
.scene-quote:before,.scene-quote:after{font-size:3rem;color:var(--primary-light);opacity:0.5;position:absolute;font-family:Georgia,serif}
.scene-quote:before{content:'"';top:-1rem;left:0}
.scene-quote:after{content:'"';bottom:-2rem;right:0}
.scene-quote-author{font-family:var(--font-body);font-size:0.85rem;color:var(--primary-light);margin-top:1.25rem;font-style:normal;opacity:0;transform:translateY(15px);letter-spacing:0.05em}

/* Animations */
.scene.active .scene-eyebrow{animation:revealUp 0.6s 0.1s cubic-bezier(0.22,1,0.36,1) forwards}
.scene.active .scene-title{animation:revealUp 0.6s 0.2s cubic-bezier(0.22,1,0.36,1) forwards}
.scene.active .scene-subtitle{animation:revealUp 0.6s 0.3s cubic-bezier(0.22,1,0.36,1) forwards}
.scene.active .scene-body{animation:revealUp 0.6s 0.4s cubic-bezier(0.22,1,0.36,1) forwards}
.scene.active .scene-bullets{animation:revealUp 0.6s 0.5s cubic-bezier(0.22,1,0.36,1) forwards}
.scene.active .scene-cards{animation:revealUp 0.6s 0.45s cubic-bezier(0.22,1,0.36,1) forwards}
.scene.active .scene-timeline{animation:revealUp 0.6s 0.45s cubic-bezier(0.22,1,0.36,1) forwards}
.scene.active .scene-stat-value{animation:popIn 0.7s 0.2s cubic-bezier(0.22,1,0.36,1) forwards}
.scene.active .scene-stat-label{animation:revealUp 0.6s 0.5s cubic-bezier(0.22,1,0.36,1) forwards}
.scene.active .scene-quote{animation:revealUp 0.7s 0.2s cubic-bezier(0.22,1,0.36,1) forwards}
.scene.active .scene-quote-author{animation:revealUp 0.6s 0.6s cubic-bezier(0.22,1,0.36,1) forwards}

@keyframes revealUp{to{opacity:1;transform:translateY(0) translateX(0)}}
@keyframes popIn{to{opacity:1;transform:scale(1)}}

/* Video Controls */
.controls{background:linear-gradient(to top,rgba(0,0,0,0.95) 0%,rgba(0,0,0,0.6) 60%,transparent 100%);position:absolute;bottom:0;left:0;right:0;padding:2rem 1.25rem 1rem;opacity:0;transition:opacity 0.3s}
.player-wrapper:hover .controls{opacity:1}

.scrubber{position:relative;height:4px;background:rgba(255,255,255,0.2);border-radius:2px;cursor:pointer;margin-bottom:1rem}
.scrubber:hover{height:6px}
.scrubber-progress{height:100%;background:linear-gradient(90deg,var(--primary),var(--primary-light));border-radius:2px;pointer-events:none;position:relative;transition:width 0.1s linear}
.scrubber-handle{position:absolute;right:-7px;top:50%;width:14px;height:14px;background:#fff;border-radius:50%;transform:translateY(-50%);opacity:0;transition:opacity 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.3)}
.scrubber:hover .scrubber-handle{opacity:1}

/* Chapter Markers */
.chapter-markers{position:absolute;top:0;left:0;right:0;height:100%;pointer-events:none}
.chapter-marker{position:absolute;top:-2px;width:3px;height:calc(100% + 4px);background:rgba(255,255,255,0.4);border-radius:1px}

.ctrl-row{display:flex;align-items:center;gap:0.75rem}
.ctrl-left{display:flex;align-items:center;gap:0.75rem}
.ctrl-center{flex:1;display:flex;justify-content:center;gap:0.25rem}
.ctrl-right{display:flex;align-items:center;gap:0.5rem}

.ctrl-btn{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:transparent;border:none;border-radius:6px;color:rgba(255,255,255,0.7);cursor:pointer;transition:all 0.15s}
.ctrl-btn:hover{color:#fff;background:rgba(255,255,255,0.1)}
.ctrl-btn.play{width:44px;height:44px;background:var(--primary);color:#fff;border-radius:50%}
.ctrl-btn.play:hover{background:var(--primary-light);transform:scale(1.05)}
.ctrl-btn svg{width:16px;height:16px}
.ctrl-btn.play svg{width:20px;height:20px}

.time{font-family:var(--font-mono);font-size:0.7rem;color:rgba(255,255,255,0.7)}
.chapter-indicator{font-family:var(--font-body);font-size:0.7rem;color:rgba(255,255,255,0.6);padding:0.25rem 0.5rem;background:rgba(255,255,255,0.1);border-radius:4px}

/* Speed Control */
.speed-control{position:relative}
.speed-btn{font-family:var(--font-mono);font-size:0.7rem;padding:0.25rem 0.5rem;background:rgba(255,255,255,0.1);border:none;border-radius:4px;color:rgba(255,255,255,0.7);cursor:pointer}
.speed-btn:hover{color:#fff;background:rgba(255,255,255,0.2)}
.speed-menu{position:absolute;bottom:100%;left:50%;transform:translateX(-50%);margin-bottom:0.5rem;background:rgba(20,20,20,0.95);border:1px solid rgba(255,255,255,0.1);border-radius:6px;padding:0.25rem;display:none;min-width:60px}
.speed-menu.active{display:block}
.speed-option{display:block;width:100%;padding:0.4rem 0.5rem;background:none;border:none;color:rgba(255,255,255,0.7);font-size:0.7rem;font-family:var(--font-mono);cursor:pointer;text-align:center;border-radius:4px}
.speed-option:hover,.speed-option.active{background:var(--primary);color:#fff}

/* Volume Control */
.volume-control{display:flex;align-items:center;gap:0.25rem}
.volume-slider{width:60px;height:4px;background:rgba(255,255,255,0.2);border-radius:2px;cursor:pointer;position:relative}
.volume-level{height:100%;background:var(--primary-light);border-radius:2px;width:80%}

@media(max-width:1100px){.main{grid-template-columns:1fr}.sidebar{max-height:none}}
</style>
</head>
<body>
<header class="header">
<div class="logo"><div class="logo-icon">F</div>Flipick <span style="color:var(--primary)">Video</span></div>
<div class="status-row">
<div class="status-pill"><div class="status-dot" id="pexelsStatus"></div>Pexels</div>
<div class="status-pill"><div class="status-dot" id="claudeStatus"></div>Claude</div>
<div class="status-pill"><div class="status-dot" id="elevenStatus"></div>Voice</div>
</div>
</header>

<main class="main">
<div class="sidebar">
<div class="card">
<div class="card-header"><div class="card-title">Course Setup</div><div class="card-step">Step 1</div></div>
<div class="card-body">
<div class="form-group">
<label class="form-label">Subject / Title</label>
<input type="text" class="form-input" id="subject" placeholder="e.g. Workplace Harassment Prevention">
</div>
<div class="form-group">
<label class="form-label">Context (Optional)</label>
<textarea class="form-input" id="context" placeholder="Target audience, focus areas..."></textarea>
</div>
<div class="form-group">
<label class="form-label">Training Type</label>
<div class="select-grid" id="typeGrid"></div>
</div>
<div class="form-group">
<label class="form-label">Scenes</label>
<input type="number" class="form-input" id="sceneCount" value="15" min="5" max="50" style="width:70px">
</div>
<button class="btn btn-primary btn-full" id="btnGenTopics">Generate Topics</button>
</div>
</div>

<div class="card">
<div class="card-header"><div class="card-title">Topics</div><div class="card-step">Step 2</div></div>
<div class="card-body">
<div class="tabs">
<div class="tab active" id="tabAI">AI Generated</div>
<div class="tab" id="tabPaste">Paste Own</div>
</div>
<div id="panelAI">
<div class="topics-list" id="topicsList"><div style="padding:1.5rem;text-align:center;color:var(--gray-mid);font-size:0.8rem">Click Generate Topics</div></div>
<button class="add-btn" id="btnAddTopic">+ Add Topic</button>
</div>
<div id="panelPaste" style="display:none">
<textarea class="form-input" id="pasteArea" rows="6" placeholder="Topic 1
- Subtopic 1.1
- Subtopic 1.2"></textarea>
<button class="btn btn-secondary btn-full" style="margin-top:0.5rem" id="btnParse">Parse</button>
</div>
</div>
</div>

<div class="card">
<div class="card-header"><div class="card-title">Voice</div><div class="card-step">Step 3</div></div>
<div class="card-body">
<div class="voice-grid" id="voiceGrid"></div>
</div>
</div>

<button class="btn btn-primary btn-lg btn-full" id="btnGenVideo">Generate Video</button>
</div>

<div class="player-wrapper">
<div class="player-aspect">
<div class="player-content">
<div class="viewport" id="viewport">
<div class="loading" id="loader"><div class="spinner"></div><div class="loading-text">Generating scenes...</div></div>
<div class="empty-state" id="empty"><div class="empty-icon">ðŸŽ¬</div><div class="empty-title">Ready to Create</div><div class="empty-text">Configure and Generate</div></div>
<div id="scenes"></div>
</div>
<div class="controls" id="controls">
<div class="scrubber" id="scrubber">
<div class="chapter-markers" id="chapterMarkers"></div>
<div class="scrubber-progress" id="scrubberProgress" style="width:0%">
<div class="scrubber-handle"></div>
</div>
</div>
<div class="ctrl-row">
<div class="ctrl-left">
<div class="time"><span id="curTime">0:00</span> / <span id="totTime">0:00</span></div>
<div class="chapter-indicator" id="chapterIndicator">-</div>
</div>
<div class="ctrl-center">
<button class="ctrl-btn" id="btnStart" title="Start"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
<button class="ctrl-btn" id="btnRew" title="Rewind"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/></svg></button>
<button class="ctrl-btn play" id="btnPlay" title="Play"><svg viewBox="0 0 24 24" fill="currentColor" id="playIcon"><polygon points="5 3 19 12 5 21"/></svg></button>
<button class="ctrl-btn" id="btnFwd" title="Forward"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/></svg></button>
<button class="ctrl-btn" id="btnEnd" title="End"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zm10 0h2V6h-2v12z"/></svg></button>
</div>
<div class="ctrl-right">
<div class="speed-control">
<button class="speed-btn" id="speedBtn">1x</button>
<div class="speed-menu" id="speedMenu">
<button class="speed-option" data-speed="0.5">0.5x</button>
<button class="speed-option" data-speed="0.75">0.75x</button>
<button class="speed-option active" data-speed="1">1x</button>
<button class="speed-option" data-speed="1.25">1.25x</button>
<button class="speed-option" data-speed="1.5">1.5x</button>
<button class="speed-option" data-speed="2">2x</button>
</div>
</div>
<div class="volume-control">
<button class="ctrl-btn" id="btnVol"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg></button>
<div class="volume-slider" id="volSlider"><div class="volume-level" id="volLevel"></div></div>
</div>
<button class="ctrl-btn" id="btnFS" title="Fullscreen"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/></svg></button>
</div>
</div>
</div>
</div>
</div>
</div>
</main>

<script>
var API="http://localhost:3001/api";
var topics=[],scenes=[],chapters=[],curScene=0,playing=false,timer=null,baseDuration=8000,duration=8000,progress=0,trainType="compliance",voice="none",playbackSpeed=1,volume=0.8;
var types=["Compliance","Onboarding","Skills","Safety","Leadership","Product"];
var voices=[{id:"none",name:"No Voice"},{id:"rachel",name:"Rachel"},{id:"josh",name:"Josh"},{id:"bella",name:"Bella"}];

document.addEventListener("DOMContentLoaded",init);

function init(){
  renderTypes();
  renderVoices();
  
  document.getElementById("tabAI").onclick=function(){
    document.getElementById("tabAI").classList.add("active");
    document.getElementById("tabPaste").classList.remove("active");
    document.getElementById("panelAI").style.display="block";
    document.getElementById("panelPaste").style.display="none";
  };
  
  document.getElementById("tabPaste").onclick=function(){
    document.getElementById("tabPaste").classList.add("active");
    document.getElementById("tabAI").classList.remove("active");
    document.getElementById("panelPaste").style.display="block";
    document.getElementById("panelAI").style.display="none";
  };
  
  document.getElementById("btnGenTopics").onclick=genTopics;
  document.getElementById("btnAddTopic").onclick=addTopic;
  document.getElementById("btnParse").onclick=parseTopics;
  document.getElementById("btnGenVideo").onclick=genVideo;
  document.getElementById("btnPlay").onclick=togglePlay;
  document.getElementById("btnStart").onclick=function(){goScene(0)};
  document.getElementById("btnEnd").onclick=function(){goScene(scenes.length-1)};
  document.getElementById("btnRew").onclick=function(){goScene(Math.max(0,curScene-1))};
  document.getElementById("btnFwd").onclick=function(){goScene(Math.min(scenes.length-1,curScene+1))};
  document.getElementById("btnFS").onclick=toggleFS;
  document.getElementById("scrubber").onclick=scrubberClick;
  document.getElementById("scrubber").onmousedown=scrubberDrag;
  
  // Speed control
  document.getElementById("speedBtn").onclick=function(){
    document.getElementById("speedMenu").classList.toggle("active");
  };
  document.querySelectorAll(".speed-option").forEach(function(el){
    el.onclick=function(){
      playbackSpeed=parseFloat(el.dataset.speed);
      duration=baseDuration/playbackSpeed;
      document.getElementById("speedBtn").textContent=el.textContent;
      document.querySelectorAll(".speed-option").forEach(function(e){e.classList.remove("active")});
      el.classList.add("active");
      document.getElementById("speedMenu").classList.remove("active");
    };
  });
  
  // Volume control
  document.getElementById("volSlider").onclick=function(e){
    var rect=e.currentTarget.getBoundingClientRect();
    volume=Math.max(0,Math.min(1,(e.clientX-rect.left)/rect.width));
    document.getElementById("volLevel").style.width=(volume*100)+"%";
  };
  
  // Close menus on outside click
  document.onclick=function(e){
    if(!e.target.closest(".speed-control")){
      document.getElementById("speedMenu").classList.remove("active");
    }
  };
  
  checkStatus();
}

function renderTypes(){
  var h="";
  types.forEach(function(t,i){
    h+="<div class='select-option"+(i===0?" selected":"")+"' data-v='"+t.toLowerCase()+"'>"+t+"</div>";
  });
  document.getElementById("typeGrid").innerHTML=h;
  document.querySelectorAll("#typeGrid .select-option").forEach(function(el){
    el.onclick=function(){
      document.querySelectorAll("#typeGrid .select-option").forEach(function(e){e.classList.remove("selected")});
      el.classList.add("selected");
      trainType=el.getAttribute("data-v");
    };
  });
}

function renderVoices(){
  var h="";
  voices.forEach(function(v,i){
    h+="<div class='voice-card"+(i===0?" selected":"")+"' data-v='"+v.id+"'><div style='font-weight:500'>"+v.name+"</div></div>";
  });
  document.getElementById("voiceGrid").innerHTML=h;
  document.querySelectorAll("#voiceGrid .voice-card").forEach(function(el){
    el.onclick=function(){
      document.querySelectorAll("#voiceGrid .voice-card").forEach(function(e){e.classList.remove("selected")});
      el.classList.add("selected");
      voice=el.getAttribute("data-v");
    };
  });
}

function genTopics(){
  var subj=document.getElementById("subject").value.trim();
  if(!subj){alert("Enter a subject");return}
  showLoad(true,"Generating topics with AI...");
  fetch(API+"/claude/topics",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      subject:subj,
      context:document.getElementById("context").value,
      trainingType:trainType,
      sceneCount:parseInt(document.getElementById("sceneCount").value)||15
    })
  })
  .then(function(r){return r.json()})
  .then(function(d){
    if(d.success&&d.topics){
      topics=d.topics;
      renderTopics();
    }
    showLoad(false);
  })
  .catch(function(){showLoad(false)});
}

function renderTopics(){
  var el=document.getElementById("topicsList");
  if(!topics.length){
    el.innerHTML="<div style='padding:1.5rem;text-align:center;color:var(--gray-mid)'>No topics</div>";
    return;
  }
  var h="";
  topics.forEach(function(t,i){
    h+="<div class='topic-item'><span class='topic-name'>"+t.name+"</span><button class='topic-del' onclick='delTopic("+i+")'>x</button></div>";
    if(t.subtopics){
      t.subtopics.forEach(function(s,j){
        var nm=typeof s==="string"?s:s.name;
        h+="<div class='topic-item sub'><span class='topic-name'>"+nm+"</span><button class='topic-del' onclick='delSub("+i+","+j+")'>x</button></div>";
      });
    }
  });
  el.innerHTML=h;
}

function addTopic(){
  topics.push({name:"New Topic",subtopics:["Subtopic 1"]});
  renderTopics();
}

function delTopic(i){
  topics.splice(i,1);
  renderTopics();
}

function delSub(i,j){
  topics[i].subtopics.splice(j,1);
  renderTopics();
}

function parseTopics(){
  var txt=document.getElementById("pasteArea").value;
  var lines=txt.split("\n").filter(function(l){return l.trim()});
  topics=[];
  var cur=null;
  lines.forEach(function(line){
    var t=line.trim();
    if(t.charAt(0)==="-"){
      if(cur)cur.subtopics.push(t.substring(1).trim());
    }else if(t){
      cur={name:t,subtopics:[]};
      topics.push(cur);
    }
  });
  document.getElementById("tabAI").click();
  renderTopics();
}

function genVideo(){
  if(!topics.length){alert("Generate topics first");return}
  showLoad(true,"Generating cinematic scenes...");
  fetch(API+"/scenes/generate",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      content:{topics:topics},
      sceneCount:parseInt(document.getElementById("sceneCount").value)||15,
      courseName:document.getElementById("subject").value||"Training"
    })
  })
  .then(function(r){return r.json()})
  .then(function(d){
    if(d.success){
      scenes=d.scenes;
      buildChapters();
      renderScenes();
      renderChapterMarkers();
    }
    showLoad(false);
    document.getElementById("empty").style.display="none";
  })
  .catch(function(e){
    console.error(e);
    showLoad(false);
  });
}

function buildChapters(){
  chapters=[];
  scenes.forEach(function(s,i){
    if(s.type==="chapter"||s.type==="intro"){
      chapters.push({index:i,title:s.title||s.eyebrow||"Chapter"});
    }
  });
}

function renderChapterMarkers(){
  var container=document.getElementById("chapterMarkers");
  var h="";
  chapters.forEach(function(ch){
    var pct=(ch.index/scenes.length)*100;
    if(ch.index>0){
      h+="<div class='chapter-marker' style='left:"+pct+"%'></div>";
    }
  });
  container.innerHTML=h;
}

function getCurrentChapter(){
  var current=chapters[0];
  for(var i=0;i<chapters.length;i++){
    if(chapters[i].index<=curScene){
      current=chapters[i];
    }
  }
  return current;
}

function renderScenes(){
  var el=document.getElementById("scenes");
  var h="";
  
  scenes.forEach(function(s,i){
    var ac=i===0?" active":"";
    var bg="";
    
    if(s.asset){
      if(s.asset.type==="image"){
        bg="<img src='"+s.asset.url+"' alt=''>";
      }else{
        bg="<video src='"+s.asset.url+"' autoplay loop muted playsinline></video>";
      }
    }else{
      bg="<div style='width:100%;height:100%;background:linear-gradient(135deg,#1e1b4b 0%,#312e81 50%,#1e1b4b 100%)'></div>";
    }
    
    var centered=(s.layout==="stat"||s.layout==="quote"||s.type==="intro"||s.type==="closing")?" centered":"";
    
    h+="<div class='scene"+ac+"'>";
    h+="<div class='scene-bg'>"+bg+"</div>";
    h+="<div class='scene-overlay'></div>";
    h+="<div class='scene-vignette'></div>";
    h+="<div class='scene-grain'></div>";
    h+="<div class='scene-color-grade'></div>";
    h+="<div class='scene-content"+centered+"'>";
    
    if(s.layout==="stat"&&s.statValue){
      h+="<div class='scene-stat'>";
      h+="<div class='scene-stat-value'>"+s.statValue+"</div>";
      h+="<div class='scene-stat-label'>"+(s.statLabel||"")+"</div>";
      h+="</div>";
      if(s.body)h+="<p class='scene-body' style='text-align:center;margin-top:1rem'>"+s.body+"</p>";
    }else if(s.layout==="quote"&&s.quote){
      h+="<div class='scene-quote-wrapper'>";
      h+="<div class='scene-quote'>"+s.quote+"</div>";
      if(s.quoteAuthor)h+="<div class='scene-quote-author'>"+s.quoteAuthor+"</div>";
      h+="</div>";
    }else if((s.layout==="cards2"||s.layout==="cards4"||s.layout==="cards6")&&s.cards){
      if(s.eyebrow)h+="<div class='scene-eyebrow'>"+s.eyebrow+"</div>";
      if(s.title)h+="<h2 class='scene-title'>"+s.title+"</h2>";
      var cols=s.layout==="cards2"?"cols-2":"cols-3";
      h+="<div class='scene-cards "+cols+"'>";
      s.cards.forEach(function(c){
        h+="<div class='scene-card'>";
        h+="<div class='scene-card-title'>"+c.title+"</div>";
        h+="<div class='scene-card-desc'>"+(c.desc||"")+"</div>";
        h+="</div>";
      });
      h+="</div>";
    }else if(s.layout==="timeline"&&s.timelineItems){
      if(s.eyebrow)h+="<div class='scene-eyebrow'>"+s.eyebrow+"</div>";
      if(s.title)h+="<h2 class='scene-title'>"+s.title+"</h2>";
      h+="<div class='scene-timeline'>";
      s.timelineItems.forEach(function(t){
        h+="<div class='timeline-item'>";
        h+="<div class='timeline-year'>"+t.year+"</div>";
        h+="<div class='timeline-event'>"+t.event+"</div>";
        h+="</div>";
      });
      h+="</div>";
    }else{
      if(s.eyebrow)h+="<div class='scene-eyebrow'>"+s.eyebrow+"</div>";
      if(s.title)h+="<h2 class='scene-title'>"+s.title+"</h2>";
      if(s.subtitle)h+="<div class='scene-subtitle'>"+s.subtitle+"</div>";
      if(s.body)h+="<p class='scene-body'>"+s.body+"</p>";
      if(s.bullets&&s.bullets.length){
        h+="<ul class='scene-bullets'>";
        s.bullets.forEach(function(b){h+="<li>"+b+"</li>"});
        h+="</ul>";
      }
    }
    
    h+="</div></div>";
  });
  
  el.innerHTML=h;
  updTime();
  updProgress();
  updChapterIndicator();
}

function togglePlay(){
  playing?pause():play();
}

function play(){
  if(!scenes.length)return;
  playing=true;
  updPlayBtn();
  tick();
}

function pause(){
  playing=false;
  updPlayBtn();
  cancelAnimationFrame(timer);
}

function tick(){
  if(!playing)return;
  progress+=16.67*playbackSpeed;
  if(progress>=duration){
    progress=0;
    if(curScene<scenes.length-1){
      goScene(curScene+1);
    }else{
      pause();
      return;
    }
  }
  updProgress();
  updTime();
  timer=requestAnimationFrame(tick);
}

function updPlayBtn(){
  var icon=document.getElementById("playIcon");
  icon.innerHTML=playing
    ?"<rect x='6' y='4' width='4' height='16'/><rect x='14' y='4' width='4' height='16'/>"
    :"<polygon points='5 3 19 12 5 21'/>";
}

function goScene(i){
  if(i<0||i>=scenes.length)return;
  
  var oldScene=document.querySelectorAll(".scene")[curScene];
  var newScene=document.querySelectorAll(".scene")[i];
  
  if(oldScene)oldScene.classList.remove("active");
  if(newScene)newScene.classList.add("active");
  
  curScene=i;
  progress=0;
  updProgress();
  updTime();
  updChapterIndicator();
}

function updChapterIndicator(){
  var ch=getCurrentChapter();
  var chIndex=chapters.indexOf(ch)+1;
  var indicator=document.getElementById("chapterIndicator");
  if(ch&&chapters.length>1){
    indicator.textContent="Ch "+chIndex+"/"+chapters.length;
  }else{
    indicator.textContent="Scene "+(curScene+1)+"/"+scenes.length;
  }
}

function updProgress(){
  var scenePct=progress/duration;
  var totalPct=((curScene+scenePct)/scenes.length)*100;
  document.getElementById("scrubberProgress").style.width=totalPct+"%";
}

function updTime(){
  var tot=scenes.length*(baseDuration/1000);
  var cur=(curScene*(baseDuration/1000))+(progress/1000*playbackSpeed);
  document.getElementById("curTime").textContent=fmtTime(cur);
  document.getElementById("totTime").textContent=fmtTime(tot);
}

function fmtTime(s){
  var m=Math.floor(s/60);
  var sec=Math.floor(s%60);
  return m+":"+(sec<10?"0":"")+sec;
}

function scrubberClick(e){
  var rect=e.currentTarget.getBoundingClientRect();
  var pct=(e.clientX-rect.left)/rect.width;
  var targetScene=Math.floor(pct*scenes.length);
  if(targetScene>=scenes.length)targetScene=scenes.length-1;
  var sceneProgress=(pct*scenes.length-targetScene)*duration;
  goScene(targetScene);
  progress=sceneProgress;
  updProgress();
}

function scrubberDrag(e){
  var scrubber=document.getElementById("scrubber");
  var onMove=function(ev){
    var rect=scrubber.getBoundingClientRect();
    var pct=Math.max(0,Math.min(1,(ev.clientX-rect.left)/rect.width));
    var targetScene=Math.floor(pct*scenes.length);
    if(targetScene>=scenes.length)targetScene=scenes.length-1;
    var sceneProgress=(pct*scenes.length-targetScene)*duration;
    if(targetScene!==curScene)goScene(targetScene);
    progress=sceneProgress;
    updProgress();
  };
  var onUp=function(){
    document.removeEventListener("mousemove",onMove);
    document.removeEventListener("mouseup",onUp);
  };
  document.addEventListener("mousemove",onMove);
  document.addEventListener("mouseup",onUp);
}

function toggleFS(){
  var el=document.querySelector(".player-wrapper");
  if(document.fullscreenElement){
    document.exitFullscreen();
  }else{
    el.requestFullscreen();
  }
}

function checkStatus(){
  fetch(API+"/status")
  .then(function(r){return r.json()})
  .then(function(d){
    if(d.services){
      if(d.services.pexels&&d.services.pexels.configured)document.getElementById("pexelsStatus").classList.add("on");
      if(d.services.claude&&d.services.claude.configured)document.getElementById("claudeStatus").classList.add("on");
      if(d.services.elevenLabs&&d.services.elevenLabs.configured)document.getElementById("elevenStatus").classList.add("on");
    }
  })
  .catch(function(){});
}

function showLoad(show,txt){
  var el=document.getElementById("loader");
  el.querySelector(".loading-text").textContent=txt||"Loading...";
  if(show){
    el.classList.add("active");
  }else{
    el.classList.remove("active");
  }
}

// Keyboard shortcuts
document.onkeydown=function(e){
  if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA")return;
  if(e.code==="Space"){e.preventDefault();togglePlay()}
  if(e.code==="ArrowRight")goScene(curScene+1);
  if(e.code==="ArrowLeft")goScene(curScene-1);
  if(e.code==="Home")goScene(0);
  if(e.code==="End")goScene(scenes.length-1);
  if(e.code==="KeyF")toggleFS();
};
</script>
</body>
</html>
